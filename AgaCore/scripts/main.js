var d=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var y=Object.getOwnPropertyNames;var g=Object.prototype.hasOwnProperty;var p=(t,e,a,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of y(e))!g.call(t,r)&&r!==a&&d(t,r,{get:()=>e[r],enumerable:!(n=_(e,r))||n.enumerable});return t},u=(t,e,a)=>(p(t,e,"default"),a&&p(a,e,"default"));var o={};u(o,I);import*as I from"@minecraft/server";var k={[o.Direction.Up]:"above",[o.Direction.East]:"east",[o.Direction.West]:"west",[o.Direction.Down]:"below",[o.Direction.South]:"south",[o.Direction.North]:"north"};function i(t){if(t.getGameMode()===o.GameMode.Creative)return;let e=t.getComponent("minecraft:inventory")?.container,a=t.selectedSlotIndex,n=e?.getItem(a);n?.amount>1?(n.amount--,e.setItem(a,n)):e.setItem(a)}var c="aga:composter_filled_level";function h(t){if(!t)return 0;let e=t.getComponent("minecraft:compostable");if(e.isValid)return e.compostingChance/100;switch(t.typeId){case"minecraft:pumpkin_pie":case"minecraft:cake":return 1;case"minecraft:baked_potato":case"minecraft:bread":case"minecraft:cookie":case"minecraft:flowering_azalea":case"minecraft:hay_block":case"minecraft:brown_mushroom_block":case"minecraft:red_mushroom_block":case"minecraft:nether_wart_block":case"minecraft:warped_wart_block":case"minecraft:pitcher_plant":case"minecraft:torchflower":return .85;case"minecraft:apple":case"minecraft:azalea":case"minecraft:beetroot":case"minecraft:big_dripleaf":case"minecraft:cocoa_beans":case"minecraft:fern":case"minecraft:red_flower":case"minecraft:yellow_flower":case"minecraft:crimson_fungus":case"minecraft:warped_fungus":case"minecraft:waterlily":case"minecraft:melon_block":case"minecraft:moss_block":case"minecraft:brown_mushroom":case"minecraft:red_mushroom":case"minecraft:mushroom_stem":case"minecraft:nether_wart":case"minecraft:potato":case"minecraft:pumpkin":case"minecraft:carved_pumpkin":case"minecraft:crimson_roots":case"minecraft:warped_roots":case"minecraft:sea_pickle":case"minecraft:shroomlight":case"minecraft:spore_blossom":case"minecraft:wheat":return .65;case"minecraft:cactus":case"minecraft:dried_kelp_block":case"minecraft:azalea_leaves_flowered":case"minecraft:glow_lichen":case"minecraft:melon_slice":case"minecraft:nether_sprouts":case"minecraft:sugar_cane":case"minecraft:tallgrass":case"minecraft:twisting_vines":case"minecraft:vine":case"minecraft:weeping_vines":return .5;case"minecraft:beetroot_seeds":case"minecraft:dried_kelp":case"minecraft:glow_berries":case"minecraft:grass":case"minecraft:grass_block":case"minecraft:hanging_roots":case"minecraft:mangrove_roots":case"minecraft:kelp":case"minecraft:leaves":case"minecraft:leaves2":case"minecraft:mangrove_leaves":case"minecraft:cherry_leaves":case"minecraft:azalea_leaves":case"minecraft:melon_seeds":case"minecraft:moss_carpet":case"minecraft:pink_petals":case"minecraft:pitcher_pod":case"minecraft:pumpkin_seeds":case"minecraft:sapling":case"minecraft:cherry_sapling":case"minecraft:seagrass":case"minecraft:small_dripleaf_block":case"minecraft:sweet_berries":case"minecraft:torchflower_seeds":case"minecraft:wheat_seeds":return .3;default:return 0}}function b(t,e=!1){let a=new o.ItemStack("minecraft:bone_meal",1);t.dimension.spawnItem(a,t.location),e||t.setPermutation(t.permutation.withState(c,0))}function C(t,e=!1){i(t.player),t.dimension.playSound("block.composter.fill"+(e?"_success":""),t.block.location);let a=t.block.center();t.dimension.runCommand(`particle minecraft:crop_growth_emitter ${a.x} ${a.y} ${a.z}`)}var m=class{onPlayerBreak(e){e.brokenBlockPermutation.getState(c)>=8&&b(e.block,!0)}onPlayerInteract(e){let a=e.block.permutation.getState(c);if(typeof a!="number"||(a===8&&(b(e.block),e.dimension.playSound("block.composter.empty",e.block.location)),a>=7))return;let n=h(e.player?.getComponent("minecraft:equippable")?.getEquipment(o.EquipmentSlot.Mainhand));if(!n)return;let r=Math.random()<=n;if(r){let f=a+1;f<7?e.block.setPermutation(e.block.permutation.withState(c,f)):f===7&&(e.block.setPermutation(e.block.permutation.withState(c,7)),o.system.runTimeout(()=>{e.block.setPermutation(e.block.permutation.withState(c,8)),e.dimension.playSound("block.composter.ready",e.block.location)},20))}C(e,r)}};function w(t){let e=t.getComponent("minecraft:inventory")?.container;if(e)for(let a=0;a<=e.size;a++)try{let n=e.getItem(a);n&&(t.dimension.spawnItem(n,t.location),e.setItem(a))}catch{break}return t}var s=class{onPlayerInteract(e){if(e.block.permutation.getState("frame:open")==0){let n=o.system.runInterval(()=>{let r=e.block.permutation.getState("frame:open");r<5?e.block.setPermutation(e.block.permutation.withState("frame:open",r+1)):(o.system.clearRun(n),e.dimension.playSound("random.chestopen",e.block,{volume:.7}))},0)}else if(e.block.permutation.getState("frame:open")===5){let n=o.system.runInterval(()=>{let r=e.block.permutation.getState("frame:open");r>0?e.block.setPermutation(e.block.permutation.withState("frame:open",r-1)):(o.system.clearRun(n),e.dimension.playSound("random.chestclosed",e.block,{volume:.7}))},0)}}onPlace(e,{params:a}){let n=e.dimension.spawnEntity(a.container,{x:e.block.x+.5,y:e.block.y,z:e.block.z+.5});n.nameTag=`tile.${e.block.typeId}.name`,n.addTag("aga_waila:ignoreRaycast")}onPlayerBreak(e,{params:a}){e.dimension.getEntitiesAtBlockLocation(e.block.location).forEach(n=>{n.typeId===a.container&&w(n).remove()})}};function B(t){let e=t.block.permutation.getState("aga:double_bit");if(e===void 0||e)return!1;let a=t.block.permutation.getState("minecraft:vertical_half");return a===void 0||t.itemStack?.typeId!==t.block.typeId?!1:a==="bottom"&&t.blockFace===o.Direction.Up||a==="top"&&t.blockFace===o.Direction.Down}function S(t){if(B(t))return t.block;let a=t.block[k[t.blockFace]](1);if(a.typeId===t.itemStack?.typeId){let n=a.permutation.getState("aga:double_bit");return n===void 0||n?void 0:a}}var l=class{onPlayerBreak(e){if(!e.brokenBlockPermutation.getState("aga:double_bit"))return;let n=new o.ItemStack(e.brokenBlockPermutation.type.id,1);e.dimension.spawnItem(n,e.block.location)}};o.world.beforeEvents.playerInteractWithBlock.subscribe(t=>{let e=S(t);t.cancel=!!e,e&&o.system.run(()=>{e.setPermutation(e.permutation.withState("minecraft:vertical_half","top").withState("aga:double_bit",!0));let a=e.getComponent("aga:slab")?.customComponentParameters?.params?.sound||"use.wood";e.dimension.playSound(a,e.location,{volume:.5}),i(t.player)})});o.system.beforeEvents.startup.subscribe(({blockComponentRegistry:t})=>{t.registerCustomComponent("aga:composter",new m),t.registerCustomComponent("aga:chest",new s),t.registerCustomComponent("aga:slab",new l)});
