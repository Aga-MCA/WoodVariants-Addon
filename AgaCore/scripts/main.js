var B=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var S=Object.getOwnPropertyNames;var I=Object.prototype.hasOwnProperty;var d=(t,e,o,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let r of S(e))!I.call(t,r)&&r!==o&&B(t,r,{get:()=>e[r],enumerable:!(n=w(e,r))||n.enumerable});return t},y=(t,e,o)=>(d(t,e,"default"),o&&d(o,e,"default"));var a={};y(a,q);import*as q from"@minecraft/server";var g={[a.Direction.Up]:"above",[a.Direction.East]:"east",[a.Direction.West]:"west",[a.Direction.Down]:"below",[a.Direction.South]:"south",[a.Direction.North]:"north"};function l(t){if(t.getGameMode()===a.GameMode.Creative)return;let e=t.getComponent("minecraft:inventory")?.container,o=t.selectedSlotIndex,n=e?.getItem(o);n?.amount>1?(n.amount--,e.setItem(o,n)):e.setItem(o)}var i="aga:composter_filled_level";function P(t){if(!t)return 0;let e=t.getComponent("minecraft:compostable");if(e?.isValid)return e.compostingChance/100;switch(t.typeId){case"minecraft:pumpkin_pie":case"minecraft:cake":return 1;case"minecraft:baked_potato":case"minecraft:bread":case"minecraft:cookie":case"minecraft:flowering_azalea":case"minecraft:hay_block":case"minecraft:brown_mushroom_block":case"minecraft:red_mushroom_block":case"minecraft:nether_wart_block":case"minecraft:warped_wart_block":case"minecraft:pitcher_plant":case"minecraft:torchflower":return .85;case"minecraft:apple":case"minecraft:azalea":case"minecraft:beetroot":case"minecraft:big_dripleaf":case"minecraft:cocoa_beans":case"minecraft:fern":case"minecraft:red_flower":case"minecraft:yellow_flower":case"minecraft:crimson_fungus":case"minecraft:warped_fungus":case"minecraft:waterlily":case"minecraft:melon_block":case"minecraft:moss_block":case"minecraft:brown_mushroom":case"minecraft:red_mushroom":case"minecraft:mushroom_stem":case"minecraft:nether_wart":case"minecraft:potato":case"minecraft:pumpkin":case"minecraft:carved_pumpkin":case"minecraft:crimson_roots":case"minecraft:warped_roots":case"minecraft:sea_pickle":case"minecraft:shroomlight":case"minecraft:spore_blossom":case"minecraft:wheat":return .65;case"minecraft:cactus":case"minecraft:dried_kelp_block":case"minecraft:azalea_leaves_flowered":case"minecraft:glow_lichen":case"minecraft:melon_slice":case"minecraft:nether_sprouts":case"minecraft:sugar_cane":case"minecraft:tallgrass":case"minecraft:twisting_vines":case"minecraft:vine":case"minecraft:weeping_vines":return .5;case"minecraft:beetroot_seeds":case"minecraft:dried_kelp":case"minecraft:glow_berries":case"minecraft:grass":case"minecraft:grass_block":case"minecraft:hanging_roots":case"minecraft:mangrove_roots":case"minecraft:kelp":case"minecraft:leaves":case"minecraft:leaves2":case"minecraft:mangrove_leaves":case"minecraft:cherry_leaves":case"minecraft:azalea_leaves":case"minecraft:melon_seeds":case"minecraft:moss_carpet":case"minecraft:pink_petals":case"minecraft:pitcher_pod":case"minecraft:pumpkin_seeds":case"minecraft:sapling":case"minecraft:cherry_sapling":case"minecraft:seagrass":case"minecraft:small_dripleaf_block":case"minecraft:sweet_berries":case"minecraft:torchflower_seeds":case"minecraft:wheat_seeds":return .3;default:return 0}}function _(t,e=!1){let o=new a.ItemStack("minecraft:bone_meal",1);t.dimension.spawnItem(o,t.location),e||t.setPermutation(t.permutation.withState(i,0))}function E(t,e=!1){l(t.player),t.dimension.playSound("block.composter.fill"+(e?"_success":""),t.block.location);let o=t.block.center();t.dimension.runCommand(`particle minecraft:crop_growth_emitter ${o.x} ${o.y} ${o.z}`)}var p=class{onPlayerBreak(e){e.brokenBlockPermutation.getState(i)>=8&&_(e.block,!0)}onPlayerInteract(e){let o=e.block.permutation.getState(i);if(typeof o!="number"||(o===8&&(_(e.block),e.dimension.playSound("block.composter.empty",e.block.location)),o>=7))return;let n=P(e.player?.getComponent("minecraft:equippable")?.getEquipment(a.EquipmentSlot.Mainhand));if(!n)return;let r=Math.random()<=n;if(r){let c=o+1;c<7?e.block.setPermutation(e.block.permutation.withState(i,c)):c===7&&(e.block.setPermutation(e.block.permutation.withState(i,7)),a.system.runTimeout(()=>{e.block.setPermutation(e.block.permutation.withState(i,8)),e.dimension.playSound("block.composter.ready",e.block.location)},20))}E(e,r)}};var m="frame:open";function x(t){let e=t.getComponent("minecraft:inventory")?.container;if(e)for(let o=0;o<=e.size;o++)try{let n=e.getItem(o);n&&(t.dimension.spawnItem(n,t.location),e.setItem(o))}catch{break}return t}var f=class{onPlayerInteract(e){if(e.block.permutation.getState(m)==0){let n=a.system.runInterval(()=>{let r=e.block.permutation.getState(m);typeof r=="number"&&r<5?e.block.setPermutation(e.block.permutation.withState(m,r+1)):(a.system.clearRun(n),e.dimension.playSound("random.chestopen",e.block,{volume:.7}))},0)}else if(e.block.permutation.getState(m)===5){let n=a.system.runInterval(()=>{let r=e.block.permutation.getState(m);typeof r=="number"&&r>0?e.block.setPermutation(e.block.permutation.withState(m,r-1)):(a.system.clearRun(n),e.dimension.playSound("random.chestclosed",e.block,{volume:.7}))},0)}}onPlace(e,o){let n=o.params,r=e.dimension.spawnEntity(n.container,{x:e.block.x+.5,y:e.block.y,z:e.block.z+.5});r.nameTag=`tile.${e.block.typeId}.name`,r.addTag("aga_waila:ignoreRaycast")}onPlayerBreak(e,o){let n=o.params;e.dimension.getEntitiesAtBlockLocation(e.block.location).forEach(r=>{r.typeId===n.container&&x(r).remove()})}};var k="aga:double_bit";function M(t){let e=t.block.permutation.getState(k);if(e===void 0||e)return!1;let o=t.block.permutation.getState("minecraft:vertical_half");return o===void 0||t.itemStack?.typeId!==t.block.typeId?!1:o==="bottom"&&t.blockFace===a.Direction.Up||o==="top"&&t.blockFace===a.Direction.Down}function D(t){if(M(t))return t.block;let o=t.block[g[t.blockFace]](1);if(o.typeId===t.itemStack?.typeId){let n=o.permutation.getState(k);return n===void 0||n?void 0:o}}var u=class{onPlayerBreak(e){if(!e.brokenBlockPermutation.getState(k))return;let n=new a.ItemStack(e.brokenBlockPermutation.type.id,1);e.dimension.spawnItem(n,e.block.location)}};a.world.beforeEvents.playerInteractWithBlock.subscribe(t=>{let e=D(t);t.cancel=!!e,e&&a.system.run(()=>{e.setPermutation(e.permutation.withState("minecraft:vertical_half","top").withState(k,!0));let o=e.getComponent("aga:slab")?.customComponentParameters?.params;e.dimension.playSound(o?.sound||"use.wood",e.location,{volume:.5}),l(t.player)})});var b=class{onMineBlock({source:e},o){if(!(e instanceof a.Player))return;let n=e.getComponent("minecraft:equippable");if(!n)return;let r=n.getEquipmentSlot(a.EquipmentSlot.Mainhand);if(!r.hasItem()||e.getGameMode()===a.GameMode.Creative)return;let c=r.getItem(),s=c?.getComponent("minecraft:durability");if(!s)return;let C=c?.getComponent("minecraft:enchantable")?.getEnchantment("unbreaking")?.level,h=s.getDamageChance(C)/100;if(Math.random()>h)return;s.damage===s.maxDurability?(r.setItem(void 0),e.playSound("random.break")):(s.damage++,r.setItem(c))}};a.system.beforeEvents.startup.subscribe(({blockComponentRegistry:t,itemComponentRegistry:e})=>{t.registerCustomComponent("aga:composter",new p),t.registerCustomComponent("aga:chest",new f),t.registerCustomComponent("aga:slab",new u),e.registerCustomComponent("aga:durability",new b)});
